import{C as n,a as i,r as u,f as D,m as h,n as b}from"./App.1690191663428.js";import{V as p}from"./vendors/vue.1690191663428.js";import{F as g}from"./rule.1690191663428.js";import"./vendors/element-plus.1690191663428.js";import"./vendors/common.1690191663428.js";var _=Object.defineProperty,x=Object.getOwnPropertyDescriptor,v=(a,e,t,s)=>{for(var o=s>1?void 0:s?x(e,t):e,r=a.length-1,l;r>=0;r--)(l=a[r])&&(o=(s?l(e,t,o):l(o))||o);return s&&o&&_(e,t,o),o};let m=class extends p{tableData=[];selectedData=[];tableLoading=!1;getTableData(a){this.tableLoading=!0,u.get(a).then(e=>{this.tableData=e.data}).finally(()=>{this.tableLoading=!1})}addTableData(a){u.patch(a).then(e=>{console.log(e)})}deleteTableData(a,e){u.delete(`${a}/${e}`).then(t=>{this.getTableData(a)})}};m=v([n],m);let d=class extends p{tableData=[];selectedData=[];tableLoading=!1;getTableData(a){this.tableLoading=!0,i.get(a).then(e=>{this.tableData=e.data}).finally(()=>{this.tableLoading=!1})}addTableData(a){i.patch(a).then(e=>{console.log(e)})}deleteTableData(a,e){i.delete(`${a}/${e}`).then(t=>{this.getTableData(a)})}};d=v([n],d);var F=Object.defineProperty,w=Object.getOwnPropertyDescriptor,C=(a,e,t,s)=>{for(var o=s>1?void 0:s?w(e,t):e,r=a.length-1,l;r>=0;r--)(l=a[r])&&(o=(s?l(e,t,o):l(o))||o);return s&&o&&F(e,t,o),o};let f=class extends p{formatFileSize(a){return D(a)}};f=C([n],f);var A=Object.defineProperty,$=Object.getOwnPropertyDescriptor,E=(a,e,t,s)=>{for(var o=s>1?void 0:s?$(e,t):e,r=a.length-1,l;r>=0;r--)(l=a[r])&&(o=(s?l(e,t,o):l(o))||o);return s&&o&&A(e,t,o),o};let c=class extends h(d,g,f){api="/app-version";tableHeader=P;isEdit=!1;showFormDialog=!1;formLoading=!1;formData={versionName:"0.0.1",versionCode:1,updateDesc:"",file:null};authLoading=!1;authError="";authCode="";showAddFormDialog(){this.isEdit=!1,this.showFormDialog=!0}showEditFormDialog(a){this.isEdit=!0,this.showFormDialog=!0,Object.keys(a).forEach(e=>{this.formData[e]=a[e]}),this.formData.updateDesc=a.updateDesc.join(`
`)}closeFormDialog(){this.formData={versionName:"1.0.0",versionCode:100,updateDesc:"",file:null},this.$refs.addFormRef.resetValidation()}uploadApp(){if(console.log(this.formData.file),this.$refs.addFormRef.validate()){this.formLoading=!0;const a=new FormData;a.set("appName",this.formData.file.name),a.set("versionName",this.formData.versionName),a.set("versionCode",this.formData.versionCode.toString()),a.set("updateDesc",""),a.set("file",this.formData.file),i.post(this.api,a).then(()=>{this.showFormDialog=!1,this.getTableData(this.api)}).finally(()=>{this.formLoading=!1})}}deleteHandler(a){this.deleteTableData(this.api,a)}clearAuth(){this.authError="",this.authCode=""}mounted(){this.getTableData(this.api)}};c=E([n],c);const P=[{text:"编号",value:"_id"},{text:"名称",value:"appName",sortable:!1,align:"center"},{text:"版本名字",value:"versionName",sortable:!1,align:"center"},{text:"版本号",value:"versionCode",sortable:!1,align:"center"},{text:"下载地址",value:"downloadUrl",sortable:!1,align:"center"},{text:"操作",value:"actions",sortable:!1,align:"center"}];var y=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("v-container",[t("v-data-table",{staticClass:"elevation-2",attrs:{"show-select":"","hide-default-footer":"","item-key":"_id","items-per-page":100,loading:e.tableLoading,headers:e.tableHeader,items:e.tableData},scopedSlots:e._u([{key:"top",fn:function(){return[t("v-toolbar",{attrs:{flat:""}},[t("v-toolbar-title",[e._v("App版本管理2")]),t("v-divider",{staticClass:"mx-4",attrs:{inset:"",vertical:""}}),t("v-spacer"),t("v-btn",{attrs:{depressed:""},on:{click:e.showAddFormDialog}},[e._v("上传App")])],1)]},proxy:!0},{key:"item.actions",fn:function({item:s}){return[t("v-btn",{attrs:{text:"",small:"",color:"primary"},on:{click:function(o){return e.showEditFormDialog(s)}}},[e._v("编辑")]),t("v-btn",{attrs:{text:"",small:"",color:"error"},on:{click:function(o){return e.deleteHandler(s._id)}}},[e._v("删除")])]}}]),model:{value:e.selectedData,callback:function(s){e.selectedData=s},expression:"selectedData"}}),t("v-dialog",{attrs:{"max-width":"600px"},on:{input:e.closeFormDialog},model:{value:e.showFormDialog,callback:function(s){e.showFormDialog=s},expression:"showFormDialog"}},[t("v-card",{attrs:{loading:e.formLoading}},[t("v-card-title",[e._v(e._s(e.isEdit?"编辑App":"上传App"))]),t("v-card-text",{staticClass:"mt-4"},[t("v-form",{ref:"addFormRef"},[t("v-text-field",{attrs:{label:"版本名字",outlined:"",rules:e.rules.requiredRule},model:{value:e.formData.versionName,callback:function(s){e.$set(e.formData,"versionName",s)},expression:"formData.versionName"}}),t("v-text-field",{attrs:{label:"版本号",outlined:"",type:"number",min:"0",rules:e.rules.requiredRule},model:{value:e.formData.versionCode,callback:function(s){e.$set(e.formData,"versionCode",s)},expression:"formData.versionCode"}}),t("v-file-input",{attrs:{label:"安装包",outlined:"","show-size":"","prepend-icon":"","truncate-length":"50",accept:".apk",rules:e.rules.requiredRule},model:{value:e.formData.file,callback:function(s){e.$set(e.formData,"file",s)},expression:"formData.file"}}),t("v-textarea",{attrs:{label:"更新描述",outlined:"","auto-grow":"",rows:"4"},model:{value:e.formData.updateDesc,callback:function(s){e.$set(e.formData,"updateDesc",s)},expression:"formData.updateDesc"}})],1)],1),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{text:"",color:"primary",disabled:e.formLoading},on:{click:e.uploadApp}},[e._v(e._s(e.isEdit?"提交更新":"上传App")+" ")])],1)],1)],1)],1)},L=[],O=b(c,y,L,!1,null,"d7062dad",null,null);const M=O.exports;export{M as default};
